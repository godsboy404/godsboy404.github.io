---    
title: Run XV6 on MacOS (ARM64)
filename: 241226
tags:  
  - 备份
date: 2024-12-26  
description: This is a simple note on running xv6 teaching OS on ARM64 arch Macintosh, which's a combination of several tutorials I searched online:）  
top: false  
share: true  
delete: false  
---

# 预准备
## THE MOST IMPORTANT
<font color=red>***请确保你已连接国际互联网，并有能力阅读英文资料，且愿意为自己的行为负责，否则请勿继续阅读，以避免不必要的损失！！！***</font>

## Install Intergrated Tools
- Feel free to paste the following magic words to the Terminal and hit ⏎:  
```bash
xcode-select --install
```

## Install Homebrew
- Next, running the following code to [install the package manager](https://brew.sh "Offical Website") :  
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
- Check if Homebrew is ready: `brew doctor`  
If it's not, STFW to solve the problem and head back here @anytime.

## Install Packages
- All you have to do is running the following prompts one by one, and it SHOULD works fine. At least my machine works fine:）  
If your computer has some mysterious problems, I'm afraid you'll have to work on your own:（
```bash
brew install python3 gawk gnu-sed gmp mpfr libmpc isl zlib expat texinfo flock libslirp qemu
brew tap riscv-software-src/riscv
brew install riscv-tools riscv64-elf-gdb
git clone https://github.com/mit-pdos/xv6-riscv.git
cd xv6-riscv
export PATH="/opt/homebrew/opt/riscv-gnu-toolchain/bin:$PATH"
source ~/.zshrc
```

- You have to downgrade gcc for xv6 to run,
```bash
brew unlink i386-elf-binutils
brew unlink gcc
brew link --overwrite riscv-gnu-toolchain
brew link --overwrite riscv-gnu-toolchain --dry-run
riscv64-unknown-elf-gcc --version
```

## Building the OS
Run following commands:
- `make clean`
- `make`
- `make qemu`

The output should looks like this:
```bash
hart 2 starting
hart 1 starting
init: starting sh
$ 
```
Try run `ls` and you'll get:
```bash
$ ls
.              1 1 1024
..             1 1 1024
README         2 2 2292
cat            2 3 35544
echo           2 4 34368
forktest       2 5 16376
grep           2 6 39000
init           2 7 34840
kill           2 8 34312
ln             2 9 34112
ls             2 10 37640
mkdir          2 11 34368
rm             2 12 34352
sh             2 13 57144
stressfs       2 14 35232
usertests      2 15 181728
grind          2 16 50616
wc             2 17 36448
zombie         2 18 33712
console        3 19 0
file.txt       2 20 0
$ 
```

To exit from QEMU kernel, press control⌃+A and then press X.  

You will be encountered with error if you don't downgrade gcc. Once downgraded, your codes won't run on Code Editors. So after successful booting of xv6, you can run the command `brew link gcc` to get back to correct lane!

# References
[1] [XV6 booting on macOS.](https://www.reddit.com/r/Operatingsystems/comments/1f2r4ii/xv6_booting_on_macos/)  
[2] [How I Set Up Xv6 On macOS](https://garbagecollected.org/2024/08/01/install-xv6/)